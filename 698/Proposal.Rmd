---
title: "Master of Analytics Research Project Proposal"
author: "Zachary Palmore"
date: "8/21/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Proposal 


### Topic 

What is the likelihood of an individual being able to own a home in areas within the United States? 

## Process 

Consider the home-buying process. What does it look like today? How does an individual go about purchasing a house these days? For a study, find the average cost of goods and typical services, the average down payment, the amount of money in savings to put down, the cost of housing, property taxes, average income for the area, age groups with average amount of debt to income, education level, and other factors that might influence whether or not an individual can buy a home. This determine how good they look to a bank. It could be considered a lending/attraction problem for localities.

This may be interesting to use with several different demographic profiles and model them after real-world scenarios. For example we could say this is Joe, heâ€™s got two kids, a dog, and lives in an apartment with his partner Jen. We also have Karen, single, 4 cats, left a large inheritance. How would these two groups do when trying to buy a house in an area? 


## Demographic Profiles

Create 3 - 5 demographic profiles to capture the story behind the data. 

## Business problem

How to attract new homebuyers to the area?

## Additional Information

Goal - finds out where we fit in but also how all of these demographics fit in

Additional Information: It might also be interesting to compare the same demographic profiles across historical trends. For example, how might a young couple, with a similar amount in savings fair compared to their older counterparts decades ago. 

```{r}
# Used with data cleaning script
library(ggplot2)
n <- 1600
combined %>% 
  sample_n(size = n, replace = F) %>%
  ggplot(aes(c(1:n), value)) + geom_point(aes(label = GeoName))  
```


# New Strategy
## Combine data sources

```{r packages}
library(tidyverse)
```



```{r CAINC1}
# Income, Population, & Per Capita Income by County from 1969 to 2019
# Extraction
cainc1 <- data.frame(read.csv(
  "https://raw.githubusercontent.com/palmorezm/msds/main/698/Data/CAINC1__ALL_AREAS_1969_2019.csv")) 
l1 <- colnames(cainc1[1:8])
l2 <- seq(1969, 2019, 1)
l3 <- c(l1, l2)
colnames(cainc1) <- l3

# Tidying
mcainc1 <- cainc1 %>% 
  gather(year, value, 
         -GeoFIPS, -GeoName, -Region, -TableName, -LineCode, 
         -IndustryClassification, -Description, -Unit) 
cainc1.personalincome <- subset(cainc1, LineCode==1)
cainc1.population <- subset(cainc1, LineCode==2)  
cainc1.percapitaincome<- subset(cainc1, LineCode==3) 
cainc1 <- rbind(cainc1.personalincome, cainc1.population, cainc1.percapitaincome)
View(mcainc1)

# Cleaning
# Determine the presence of and deal with missing Values
# sum(is.na(mcainc1)) # 153 - recheck for assurance
# which(is.na(mcainc1)) 
# mcainc1[which(is.na(mcainc1)),] # Displays all NA's (if there are any)
# Missing values in this data are direct from BEA 
# Review each subset before omission/imputation
# sum(is.na(cainc1.percapitaincome)) # 1 Missing
# which(is.na(cainc1.percapitaincome)) # At 6397
# cainc1.percapitaincome[6397,] # All missing 
# which(is.na(cainc1.personalincome)) # At 6397
# cainc1.personalincome[6397,] # All missing
# which(is.na(cainc1.population)) # At 6397
# cainc1.population[6397,] # Ditto as above
# The one missing entry from the data created 153 missing entries when gathered
mcainc1 <- na.omit(mcainc1)
sum(is.na(mcainc1)) # 0 
# However, omission removed more than expected
# count(mcainc1) - 153 # Expected 153 removals 
# sum(is.na(mcainc1)) # The value has changed. 
# Solution: During rerun update notes!
```



```{r RPP_11yr}
# Regional Price Parities by MSA from 2008 - 2019
# Extraction
rpp <- data.frame(read.csv(
  "https://raw.githubusercontent.com/palmorezm/msds/main/698/Data/rpp_msa_11yr.csv")) 
rpp <- rpp[4:nrow(rpp),]
colnames(rpp) <- rpp[1,]
rpp <- rpp[-1,]

# Tidying
mrpp <- rpp %>% 
  gather(key, value, -GeoFips, -GeoName, -LineCode, -Description) 
rpp.allitems <- subset(mrpp, LineCode==1)
rpp.goods <- subset(mrpp, LineCode==2)  
rpp.rents <- subset(mrpp, LineCode==3) 
rpp.services <- subset(mrpp, LineCode==4)  
mrpp <- rbind(rpp.allitems, rpp.goods, rpp.rents, rpp.services)
View(mrpp)

# Determine the presence of and deal with missing Values
sum(is.na(mrpp)) # 0
which(is.na(mrpp))
mrpp[which(is.na(mrpp)),] # Displays all NA's (if there are any)
# There are no missing values in this data set 
```



```{r CAINC1_11yr}
# Income, Population, & Per Capita Income by MSA from 2008 to 2019
# Extraction
cainc1 <- data.frame(read.csv(
  "https://raw.githubusercontent.com/palmorezm/msds/main/698/Data/cainc1_msa_11yr.csv")) 
cainc1 <- cainc1[4:nrow(cainc1),]
colnames(cainc1) <- cainc1[1,]
cainc1 <- cainc1[-1,]

# Tidying
minc <- cainc1 %>% 
  gather(year, value, -GeoFips, 
         -GeoName, -LineCode, -Description) 
minc.personalincome <- subset(minc, LineCode==1)
minc.population <- subset(minc, LineCode==2)  
minc.percapitaincome<- subset(minc, LineCode==3) 
minc <- rbind(minc.personalincome, minc.population, minc.percapitaincome)
View(minc)

# Cleaning
# Determine the presence of and deal with missing Values
sum(is.na(minc)) # 0
which(is.na(minc))
minc[which(is.na(minc)),] # None are missing
```


```{r merge}
minc[6:nrow(minc),] %>% 
  filter(LineCode == 3)
mrpp  %>%
  slice(-1,-2) %>%
  filter(LineCode == 1)

merged <- merge(minc, mrpp, by = "GeoFips")
merged[c("LineCode.x","year","LineCode.y","key","value.y")] <- sapply(merged[c("LineCode.x","year","LineCode.y","key","value.y")], as.numeric)
RelAf_tbl <- merged %>% 
  filter(LineCode.x == 3) %>% 
  mutate(RelAf = (value.x / value.y)/1000) %>% 
  filter(LineCode.y == 1) %>%
  arrange(desc(RelAf)) %>% 
  filter(year == 2019 & key == 2019)
write.csv(RelAf_tbl, file = "C:/Users/Owner/Documents/Data/RelAf_tbl.csv")
RelAf_tbl2 <- merged %>% 
  filter(LineCode.x == 3) %>% 
  mutate(RelAf = (value.x / value.y)/1000) %>% 
  filter(LineCode.y == 1) %>%
  arrange(desc(RelAf)) %>% 
  filter(year == 2018 & key == 2018)
write.csv(RelAf_tbl, file = "C:/Users/Owner/Documents/Data/RelAf_tbl2.csv")
RelAf_tbl3 <- merged %>% 
  filter(LineCode.x == 3) %>% 
  mutate(RelAf = (value.x / value.y)/1000) %>% 
  filter(LineCode.y == 1) %>%
  arrange(desc(RelAf)) %>% 
  filter(year == 2017 & key == 2017)
write.csv(RelAf_tbl, file = "C:/Users/Owner/Documents/Data/RelAf_tbl3.csv")
```




```{r combined}
# Rename GeoFIPS to GeoFips for binding
mcainc1 <- mcainc1 %>% 
  rename(GeoFips = GeoFIPS)
# Convert, rename, and adjust selection
mrpp <- mrpp %>% 
  rename(year = key) %>% 
  mutate(LineCode2 = as.numeric(LineCode) + 10) %>% 
  dplyr::select(-LineCode) %>% 
  rename(LineCode = LineCode2) %>% 
  dplyr::select(GeoFips, GeoName, LineCode, 
                Description, year, value)
# Repeat selection method on mcainc1 
mcainc1 <- mcainc1 %>% 
  dplyr::select(GeoFips, GeoName, LineCode, 
                Description, year, value) 
# Create combined data frame 
df <- rbind(mcainc1, mrpp) %>% 
  mutate(Year = as.numeric(year), 
         Value = as.numeric(value)) %>% 
  dplyr::select(-year, -value) 
View(df)
```



```{r}
dict <- df %>% 
  filter(LineCode == "11" & Year == "2008") 
data <- df %>% 
  filter(LineCode == "3" & Year == "2008")
data$GeoFips == dict$GeoFips

```




```{r}
df_pop_county <- data.frame(region=df$GeoFips)
df_pop_county$value <- df$GeoFips
y <- df_pop_county$value
df_pop_county$color <- gray(y / max(y))

counties <- county.fips %>% 
  left_join(df_pop_county, by = c('fips' = 'region'))
map("county", fill = TRUE, col = counties$color)

df.test <- df %>% 
  filter(LineCode == "11" & Year == "2008") %>% 
  mutate(Color = scale(Value) + 100) %>% 
  slice(-1, -2)

map("county", fill = T, col = df.test$Color[,1])
map("county", fill = T, col = df.test$Value)
?maps::map()
```





```{r}
df_mapping
```




